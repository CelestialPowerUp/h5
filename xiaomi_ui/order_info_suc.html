<!doctype html><!--[if lte IE 9]>
<html class="lte9 no-js m"><![endif]--><!--[if gt IE 9]><!-->
<html class="no-js m"><!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="renderer" content="webkit">
    <title>订单详情</title>
    <meta name="description" content="">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="./css/amazeui.min.css">
    <link rel="stylesheet" href="./css/h5.css">

    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./js/handlebars.min.js"></script>
    <script type="text/javascript" src="./js/amazeui.min.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="https://a.alipayobjects.com/u/ecmng/js/201410/3fzyLyZl9J.js"></script>
    <script type="text/javascript" src="./js/common.js"></script>
</head>
<body class="body-background-color-gray">
<div class="order-info-div">
    <p class="am-form-help order-info-help" id="msg"></p>

    <div class="order-info-item-content" id="user_info_view">
        <!--基本信息-->
    </div>
    <p class="order-info-title">订单项目</p>

    <div class="order-info-item-content" id="products_view">

    </div>

    <p class="order-info-title">支付信息</p>

    <div class="order-info-item-content" id="paid_view">

    </div>

    <p class="order-info-title-empty">&nbsp;</p>

    <div class="order-info-item-content" id="paid_type_view">

    </div>
</div>

<script type="text/x-handlebars-template" id="user_info_tpl">{{#this}}
<div class="am-g">
    <div class="am-u-sm-4 order-info-base"><img src="./img/user.png">{{contact_name}}</div>
    <div class="am-u-sm-4 order-info-base"><img src="./img/phone.png">{{phone_number}}</div>
    <div class="am-u-sm-4 order-info-base"><img src="./img/car.png">{{car_number}}</div>
</div>
<div class="am-g">
    <div class="am-u-sm-12 order-info-base-big">{{this.location.address}}</div>
</div>
{{/this}}</script>

<script type="text/x-handlebars-template" id="product_info_tpl">{{#each this}}
<div class="am-g order-info-box">
    <div class="am-u-sm-4 order-info-line-cell am-vertical-align">
        <div class="am-vertical-align-middle">{{product_name}}</div>
    </div>
    <div class="am-u-sm-4 order-info-line-cell am-vertical-align" style="text-align: center;">
        <div class="am-vertical-align-middle">X {{unit_count}}</div>
    </div>
    <div class="am-u-sm-4 order-info-line-cell am-vertical-align">
        <div class="am-vertical-align-middle">¥{{price}}</div>
    </div>
</div>
{{/each}}</script>

<script type="text/x-handlebars-template" id="paid_tpl">{{#this}}
{{#coupon}}
<div class="am-g order-info-box">
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align">
        <div class="am-vertical-align-middle">优惠券</div>
    </div>
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align" style="text-align: right;">
        <div class="am-vertical-align-middle">-</div>
    </div>
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align">
        <div class="am-vertical-align-middle">¥{{value}}</div>
    </div>
</div>
{{/coupon}}
<div class="am-g order-info-box">
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align">
        <div class="am-vertical-align-middle">应付金额</div>
    </div>
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align"></div>
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align">
        <div class="am-vertical-align-middle">¥{{total_price}}</div>
    </div>
</div>
{{/this}}</script>

<script type="text/x-handlebars-template" id="paid_type_tpl">{{#this}}
<div class="am-g order-info-box">
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align">
        <div class="am-vertical-align-middle">支付方式</div>
    </div>
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align"></div>
    <div class="am-u-sm-4 order-info-line-cell2 am-vertical-align">
        <div class="am-vertical-align-middle"><div>{{{pay_type_info}}}</div></div>
    </div>
</div>
{{/this}}</script>
<script type="text/javascript" src="./js/pingpp_pay.js"></script>
<script type="text/javascript">!function (t) {
    t(function () {

        loadCfg('platform.json', function (platform) {
            if ('alipay' === platform['platform']) {
                AlipayJSBridge.call('exitApp');
            }
        });

        var parse_data = function (order_info) {
            console.log(order_info);
            var template = Handlebars.compile(t("#user_info_tpl").html());
            t("#user_info_view").html(template(order_info));

            var product_template = Handlebars.compile(t("#product_info_tpl").html());
            t("#products_view").html(product_template(order_info.products));

            var paid_template = Handlebars.compile(t("#paid_tpl").html());
            t("#paid_view").html(paid_template(order_info));

            order_info.pay_type_info = getPayTypeInfo(order_info);
            var paid_type_template = Handlebars.compile(t("#paid_type_tpl").html());
            t("#paid_type_view").html(paid_type_template(order_info));

        };

        var reqParams = getReqParam();
        if (reqParams['order_id']) {//有参数，查看页面
            getReq("orders.json?order_id=" + reqParams.order_id, function (order) {
                order.car_number = order.car.licence.province + order.car.licence.number;
                order.contact_name = order.client_basic.name;
                order.phone_number = order.client_basic.phone_number;
                order.location = order.client_basic.location;
                parse_data(order);
                getStore().set('display_order', order);

                if (1 === order['pay_mode'] && !order['paid'] && order['total_price'] > 0) {
                    t('#submit_button').text('立即付款');
                    t('#submit_button').css('display', 'block');
                }
            });
        } else {
            var order = getOrder();
            if (order['coupon_value'] > 0) {
                order['coupon'] = {value:order['coupon_value']};
            }
            parse_data(order);
            t('#submit_button').text('立即预约');
            t('#submit_button').css('display', 'block');
        }

    })
}(window.jQuery);</script>
</body>
</html><!-- Cached page generated on Thu Apr 09 2015 02:58:25 GMT+0000 (UTC) -->